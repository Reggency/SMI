<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sepakat Shoes - Premium Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- TAMBAHAN: Library Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            /* Perubahan Warna Utama ke Hijau Tua Sepakat */
            --primary: #0D4715;
            --accent: #1a5c23;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f8fafc;
        }

        /* Background Doodle Overlay */
        .bg-doodle { position: relative; }
        .bg-doodle::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://img.freepik.com/free-vector/hand-drawn-abstract-doodle-pattern_23-2149293148.jpg');
            opacity: 0.03; pointer-events: none; z-index: 0;
        }

        /* Page Transitions */
        .page-section { 
            display: none; 
            animation: fadeInSlide 0.4s ease-out forwards;
        }
        .page-section.active { display: block; }

        @keyframes fadeInSlide {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sidebar Styling Sesuai Gambar */
        .sidebar-sepakat {
            background-color: #0D4715;
        }

        .nav-link {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: rgba(255, 255, 255, 0.6);
        }
        
        .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .nav-link.active-link {
            background-color: #ffffff !important;
            color: #0D4715 !important;
            font-weight: 700;
        }
        
        /* Hilangkan border accent kiri karena active-link sekarang full block white */
        .nav-link.active-link::before {
            display: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #0D4715; border-radius: 10px; }

        /* Card Interactions */
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(13 71 21 / 0.1);
        }

        /* Modal Blur */
        .modal-overlay { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background: rgba(13, 71, 21, 0.3); 
            z-index: 50; 
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease;
        }
        .modal-content { 
            position: fixed; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 51; 
            display: none; 
            animation: modalPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalPop {
            from { opacity: 0; transform: translate(-50%, -40%) scale(0.95); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; } to { opacity: 1; }
        }

        /* Form Input Specific Clarity */
        .form-input-group {
            border: 1px solid #e2e8f0;
            background: #ffffff;
            transition: all 0.2s ease;
        }
        .form-input-group:focus-within {
            border-color: #0D4715;
            box-shadow: 0 0 0 4px rgba(13, 71, 21, 0.1);
        }
    </style>
</head>
<body class="overflow-hidden">

    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>
    <div id="customModal" class="modal-content w-full max-w-md bg-white rounded-[40px] shadow-2xl border border-slate-200">
        <div class="p-8 border-b border-slate-100">
            <h3 id="modalTitle" class="text-2xl font-black text-slate-900 tracking-tight">Tambah Data</h3>
        </div>
        <div class="p-8">
            <div id="modalBody" class="space-y-6">
                <!-- Content Injected by JS -->
            </div>
            <div class="flex gap-4 mt-10">
                <button onclick="closeModal()" class="flex-1 py-4 rounded-2xl font-bold text-slate-500 hover:bg-slate-50 transition-all border border-slate-200">Batal</button>
                <button id="modalConfirmBtn" class="flex-1 py-4 rounded-2xl font-bold bg-[#0D4715] text-white hover:bg-[#1a5c23] transition-all shadow-lg shadow-green-900/20">Simpan</button>
            </div>
        </div>
    </div>

    <div class="flex h-screen w-full bg-slate-50">
        <!-- Sidebar: Diubah Warna ke Hijau Tua -->
        <aside class="w-72 sidebar-sepakat flex flex-col z-20 shadow-xl">
            <div class="p-8 flex items-center gap-3">
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-shoe-prints text-[#0D4715] text-lg"></i>
                </div>
                <span class="text-xl font-black tracking-tighter italic uppercase text-white">SEPAKAT<span class="text-green-400">.</span></span>
            </div>
            
            <nav class="flex-1 px-4 py-6 space-y-2">
                <p class="text-[10px] font-bold text-white/40 uppercase tracking-[0.2em] px-4 mb-4">Menu Utama</p>
                
                <button onclick="showPage('dashboard')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-chart-pie w-5"></i> <span class="text-sm font-semibold">Dashboard</span>
                </button>
                <button onclick="showPage('customer')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-user-group w-5"></i> <span class="text-sm font-semibold">Customer</span>
                </button>
                <button onclick="showPage('order')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-bag-shopping w-5"></i> <span class="text-sm font-semibold">Order</span>
                </button>
                <button onclick="showPage('pembayaran')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-credit-card w-5"></i> <span class="text-sm font-semibold">Pembayaran</span>
                </button>
                <button onclick="showPage('kategori')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-layer-group w-5"></i> <span class="text-sm font-semibold">Kategori</span>
                </button>
                <button onclick="showPage('produk')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-box-open w-5"></i> <span class="text-sm font-semibold">Produk</span>
                </button>
                <button onclick="showPage('order-items')" class="nav-link w-full flex items-center gap-4 px-5 py-4 rounded-2xl">
                    <i class="fas fa-list-check w-5 text-sm"></i> <span class="text-sm font-semibold">Order Items</span>
                </button>
            </nav>

            <div class="p-6 mt-auto border-t border-white/10">
                <div onclick="showPage('setting')" class="flex items-center gap-4 px-4 py-3 text-white/50 hover:text-white cursor-pointer group transition-colors">
                    <i class="fas fa-cog group-hover:rotate-90 transition-transform"></i> <span class="text-sm font-medium">Setting</span>
                </div>
                <div onclick="showPage('account')" class="mt-2 flex items-center gap-4 px-4 py-3 bg-white/5 rounded-2xl cursor-pointer hover:bg-white/10 transition-all group">
                    <div class="w-8 h-8 rounded-full overflow-hidden border border-white/20 shadow-sm">
                        <img id="sidebar-avatar" src="" class="w-full h-full object-cover">
                    </div>
                    <span id="sidebar-user-name" class="text-xs font-bold truncate text-white/80">Account</span>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-doodle overflow-hidden relative">
            <header class="h-20 flex items-center justify-between px-10 bg-white/60 backdrop-blur-md z-10 border-b border-slate-100">
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 bg-[#0D4715] rounded-full animate-pulse"></div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Admin Control Center</p>
                </div>
                <div class="flex items-center gap-3 px-4 py-2 bg-white rounded-full shadow-sm border border-slate-200">
                    <i class="fas fa-calendar-day text-[#0D4715] text-sm"></i>
                    <span id="current-date" class="text-[11px] font-extrabold text-slate-600 uppercase tracking-wider"></span>
                </div>
            </header>

            <div class="p-10 relative z-10 h-full overflow-y-auto" id="main-container">
                
                <section id="dashboard-page" class="page-section">
                    <div class="mb-10">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Overview</h2>
                        <p class="text-slate-400 mt-2 font-medium">Pantau performa bisnis Sepakat Shoes hari ini.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- Stat Card 1: Sesuai Gambar (Background Hijau) -->
                        <div class="bg-[#0D4715] p-10 rounded-[40px] text-white shadow-2xl shadow-green-900/20">
                            <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-boxes-stacked text-xl"></i>
                            </div>
                            <p class="text-xs font-bold opacity-60 uppercase tracking-widest mb-1">Total Produk</p>
                            <h4 id="stat-p" class="text-5xl font-black">0</h4>
                        </div>
                        <!-- Stat Card 2: Sesuai Gambar (Background Putih) -->
                        <div class="bg-white p-10 rounded-[40px] text-slate-900 shadow-xl shadow-slate-100 border border-slate-100">
                            <div class="w-12 h-12 bg-green-50 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-users text-xl text-[#0D4715]"></i>
                            </div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Customer</p>
                            <h4 id="stat-c" class="text-5xl font-black">0</h4>
                        </div>
                        <!-- Stat Card 3: Sesuai Gambar (Background Putih) -->
                        <div class="bg-white p-10 rounded-[40px] text-slate-900 shadow-xl shadow-slate-100 border border-slate-100">
                            <div class="w-12 h-12 bg-green-50 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-shopping-cart text-xl text-[#0D4715]"></i>
                            </div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Order</p>
                            <h4 id="stat-o" class="text-5xl font-black">0</h4>
                        </div>
                    </div>

                    <!-- TAMBAHAN: BAGIAN GRAFIK -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-10">
                        <div class="bg-white p-8 rounded-[40px] shadow-xl border border-slate-100">
                            <h3 class="text-xl font-black text-slate-900 mb-6">Analitik Pesanan</h3>
                            <div class="relative h-[300px]">
                                <canvas id="orderChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-8 rounded-[40px] shadow-xl border border-slate-100">
                            <h3 class="text-xl font-black text-slate-900 mb-6">Distribusi Kategori Produk</h3>
                            <div class="relative h-[300px] flex justify-center">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="produk-page" class="page-section">
                    <div class="mb-10">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Koleksi Produk</h2>
                        <p class="text-slate-400 mt-2 font-medium">Kelola katalog produk sepatu Anda secara efisien.</p>
                    </div>
                    <div class="bg-white rounded-[40px] shadow-xl shadow-slate-100 border border-slate-100 p-10 min-h-[500px]">
                        <div class="flex flex-wrap justify-between items-center mb-10 gap-4">
                            <div class="relative group">
                                <input type="text" id="productSearch" onkeyup="filterProducts()" placeholder="Cari nama produk..." class="pl-14 pr-8 py-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm w-80 focus:outline-none focus:ring-2 focus:ring-green-100 transition-all">
                                <i class="fas fa-search absolute left-6 top-5 text-slate-300 group-focus-within:text-[#0D4715] transition-colors"></i>
                            </div>
                            <button onclick="addProduct()" class="bg-[#0D4715] text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-xl shadow-green-900/10 hover:scale-105 active:scale-95 transition-all flex items-center gap-3">
                                <i class="fas fa-plus"></i> Tambah Produk
                            </button>
                        </div>
                        <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"></div>
                    </div>
                </section>

                <section id="customer-page" class="page-section">
                    <div class="mb-10 flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black text-slate-900 tracking-tight">Pelanggan</h2>
                            <p class="text-slate-400 mt-2 font-medium">Daftar pengguna terdaftar di platform Anda.</p>
                        </div>
                        <button onclick="addCustomer()" class="bg-[#0D4715] text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-xl hover:scale-105 transition-all">+ Pelanggan</button>
                    </div>
                    <div id="customer-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8"></div>
                </section>

                <section id="order-page" class="page-section">
                    <div class="mb-10 flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black text-slate-900 tracking-tight">Order</h2>
                            <p class="text-slate-400 mt-2 font-medium">Pantau setiap transaksi yang masuk.</p>
                        </div>
                        <button onclick="addOrder()" class="bg-[#0D4715] text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-xl hover:scale-105 transition-all">Buat Order Baru</button>
                    </div>
                    <div id="order-list-container" class="space-y-6"></div>
                </section>

                <!-- HALAMAN PEMBAYARAN -->
                <section id="pembayaran-page" class="page-section">
                    <div class="mb-10 flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black text-slate-900 tracking-tight">Pembayaran</h2>
                            <p class="text-slate-400 mt-2 font-medium">Riwayat pembayaran dan konfirmasi transaksi.</p>
                        </div>
                        <button onclick="addPayment()" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-xl hover:scale-105 transition-all">Catat Pembayaran</button>
                    </div>
                    <div class="bg-white rounded-[40px] shadow-xl shadow-slate-100 border border-slate-100 p-10 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="text-[11px] text-slate-400 uppercase font-black tracking-widest border-b border-slate-100">
                                    <tr>
                                        <th class="px-6 py-4">ID Transaksi</th>
                                        <th class="px-6 py-4">Order Ref</th>
                                        <th class="px-6 py-4">Metode</th>
                                        <th class="px-6 py-4">Jumlah</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4 text-right">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pembayaran-body" class="text-sm font-bold text-slate-700"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="order-items-page" class="page-section">
                    <div class="mb-10">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Detail Item</h2>
                        <p class="text-slate-400 mt-2 font-medium">Rincian produk dalam setiap pesanan aktif.</p>
                    </div>
                    <div class="bg-white rounded-[40px] shadow-xl shadow-slate-100 border border-slate-100 p-10 overflow-hidden">
                        <div class="mb-8 relative max-w-sm">
                            <input type="text" id="itemSearch" onkeyup="searchTable('items-body', this.value)" placeholder="Cari rincian item..." class="w-full pl-12 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none">
                            <i class="fas fa-filter absolute left-5 top-3.5 text-slate-300"></i>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="text-[11px] text-slate-400 uppercase font-black tracking-widest border-b border-slate-100">
                                    <tr>
                                        <th class="px-6 py-4">ID Pesanan</th>
                                        <th class="px-6 py-4">Nama Produk</th>
                                        <th class="px-6 py-4">Qty</th>
                                        <th class="px-6 py-4">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody id="items-body" class="text-sm font-bold text-slate-700"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="kategori-page" class="page-section">
                    <div class="mb-10 flex justify-between items-end">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Kategori</h2>
                        <button onclick="addCategory()" class="bg-[#0D4715] text-white px-8 py-4 rounded-2xl text-sm font-bold shadow-lg shadow-green-900/10">+ Kategori</button>
                    </div>
                    <div id="category-list" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
                </section>

                <section id="account-page" class="page-section">
                    <div class="mb-10 text-center md:text-left">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Pengaturan Akun</h2>
                    </div>
                    <div class="bg-white rounded-[40px] shadow-2xl shadow-slate-200/50 border border-slate-100 p-12 max-w-2xl mx-auto md:mx-0">
                        <div class="flex flex-col items-center mb-12">
                            <div class="relative group">
                                <div class="w-40 h-40 rounded-[40px] bg-slate-100 border-4 border-white shadow-2xl overflow-hidden relative">
                                    <img id="acc-avatar-preview" src="" class="w-full h-full object-cover">
                                    <div onclick="updateAvatar()" class="absolute inset-0 bg-black/60 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-all cursor-pointer">
                                        <i class="fas fa-camera text-2xl"></i>
                                    </div>
                                </div>
                            </div>
                            <h3 id="acc-name-display" class="text-2xl font-black text-slate-900 mt-6 tracking-tight"></h3>
                            <p class="text-slate-400 text-xs font-bold uppercase tracking-[0.3em] mt-1">Super Admin</p>
                        </div>
                        <div class="space-y-8">
                            <div>
                                <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 tracking-widest ml-1">Nama Lengkap</label>
                                <input type="text" id="acc-input-name" class="w-full px-8 py-5 bg-white border border-slate-200 rounded-[24px] focus:outline-none focus:ring-4 focus:ring-green-50/50 focus:border-[#0D4715] font-bold text-slate-700 transition-all">
                            </div>
                            <button onclick="saveAccount()" class="w-full bg-[#0D4715] text-white py-5 rounded-[24px] font-black hover:bg-[#1a5c23] transition-all shadow-xl shadow-green-900/20">SIMPAN PERUBAHAN</button>
                        </div>
                    </div>
                </section>

                <section id="setting-page" class="page-section">
                    <div class="mb-10 text-center md:text-left">
                        <h2 class="text-4xl font-black text-slate-900 tracking-tight">Sistem</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-[40px] p-12 shadow-xl border border-slate-100">
                            <div class="w-14 h-14 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-triangle-exclamation text-2xl"></i>
                            </div>
                            <h3 class="font-black text-2xl mb-3 text-slate-900">Reset Data</h3>
                            <p class="text-slate-400 text-sm mb-10 font-medium leading-relaxed">Kembalikan sistem ke pengaturan awal pabrik. Semua data Anda akan dihapus secara permanen.</p>
                            <button onclick="factoryReset()" class="w-full px-8 py-5 border-2 border-red-500 text-red-500 font-black rounded-[24px] hover:bg-red-500 hover:text-white transition-all">RESET DATA PABRIK</button>
                        </div>
                        <div class="bg-white rounded-[40px] p-12 shadow-xl border border-slate-100">
                            <div class="w-14 h-14 bg-green-50 text-[#0D4715] rounded-2xl flex items-center justify-center mb-6">
                                <i class="fas fa-download text-2xl"></i>
                            </div>
                            <h3 class="font-black text-2xl mb-3 text-slate-900">Backup JSON</h3>
                            <p class="text-slate-400 text-sm mb-10 font-medium leading-relaxed">Ekspor basis data Anda ke dalam file JSON untuk dipindahkan atau sebagai salinan cadangan.</p>
                            <button onclick="exportJSON()" class="w-full px-8 py-5 bg-slate-100 text-[#0D4715] font-black rounded-[24px] hover:bg-[#0D4715] hover:text-white transition-all">EXPORT DATA</button>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        // --- DATA STATE ---
        let products = JSON.parse(localStorage.getItem('products')) || [
            { id: 1, name: "Nike Air", price: 230000, category: "Sport Performance", img: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=400" },
            { id: 2, name: "New Balance", price: 200000, category: "Casual Sneakers", img: "https://images.unsplash.com/photo-1539185441755-769473a23570?q=80&w=400" },
            { id: 3, name: "Adidas Neo", price: 270000, category: "Sepatu Lari", img: "https://images.unsplash.com/photo-1587563871167-1ee9c731aefb?q=80&w=400" }
        ];

        let categories = JSON.parse(localStorage.getItem('categories')) || ["Sepatu Lari", "Casual Sneakers", "Sport Performance"];
        
        let customers = JSON.parse(localStorage.getItem('customers')) || [
            { id: 101, name: "Budi Santoso", email: "budi@mail.com" },
            { id: 102, name: "Siti Aminah", email: "siti@mail.com" }
        ];

        let orders = JSON.parse(localStorage.getItem('orders')) || [
            { id: "ORD-001", customer: "Budi Santoso", total: 460000, items: [{p: "Nike Air", qty: 2, sub: 460000}] }
        ];

        let payments = JSON.parse(localStorage.getItem('payments')) || [];

        let accountData = JSON.parse(localStorage.getItem('accountData')) || { 
            name: "Admin Sepakat", 
            avatar: "https://ui-avatars.com/api/?name=Admin&background=0D4715&color=fff" 
        };

        // --- FUNGSI FORMAT RUPIAH ---
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        // --- TAMBAHAN: FUNGSI TITIK OTOMATIS SAAT INPUT ---
        function applyThousandsSeparator(inputElement) {
            inputElement.addEventListener('input', function(e) {
                // Hapus semua karakter kecuali angka
                let value = e.target.value.replace(/[^0-9]/g, '');
                if (value === "") {
                    e.target.value = "";
                    return;
                }
                // Format dengan titik
                e.target.value = new Intl.NumberFormat('id-ID').format(value);
            });
        }

        // --- LOGIKA GRAFIK ---
        let orderChart, categoryChart;

        function updateCharts() {
            const ctxOrder = document.getElementById('orderChart').getContext('2d');
            const ctxCategory = document.getElementById('categoryChart').getContext('2d');

            if (orderChart) orderChart.destroy();
            if (categoryChart) categoryChart.destroy();

            const orderLabels = orders.map(o => o.id);
            const orderValues = orders.map(o => o.total);

            orderChart = new Chart(ctxOrder, {
                type: 'bar',
                data: {
                    labels: orderLabels.length ? orderLabels : ["No Data"],
                    datasets: [{
                        label: 'Total Nilai Pesanan (Rp.)',
                        data: orderValues.length ? orderValues : [0],
                        backgroundColor: '#0D4715',
                        borderRadius: 8,
                        barThickness: 30
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            const catCounts = categories.map(cat => products.filter(p => p.category === cat).length);
            
            categoryChart = new Chart(ctxCategory, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{
                        data: catCounts.length ? catCounts : [1],
                        backgroundColor: ['#0D4715', '#1a5c23', '#2d8a39', '#4caf50', '#81c784'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { weight: 'bold' } } }
                    },
                    cutout: '70%'
                }
            });
        }

        // --- UI UTILS ---
        const modalOverlay = document.getElementById('modalOverlay');
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalConfirmBtn = document.getElementById('modalConfirmBtn');

        function openModal(title, bodyHTML, onConfirm) {
            modalTitle.innerText = title;
            modalBody.innerHTML = bodyHTML;
            modalConfirmBtn.onclick = onConfirm;
            modalOverlay.style.display = 'block';
            customModal.style.display = 'block';
        }

        function closeModal() {
            modalOverlay.style.display = 'none';
            customModal.style.display = 'none';
        }

        function syncStorage() {
            try {
                localStorage.setItem('products', JSON.stringify(products));
                localStorage.setItem('categories', JSON.stringify(categories));
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('orders', JSON.stringify(orders));
                localStorage.setItem('payments', JSON.stringify(payments));
                localStorage.setItem('accountData', JSON.stringify(accountData));
            } catch (e) {
                console.error("Storage Error");
            }
        }

        function showPage(pageName) {
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            const targetPage = document.getElementById(pageName + '-page');
            if (targetPage) targetPage.classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active-link');
            });

            const activeNav = Array.from(document.querySelectorAll('.nav-link')).find(btn => 
                btn.getAttribute('onclick')?.includes(`'${pageName}'`)
            );
            if(activeNav) activeNav.classList.add('active-link');

            renderAll();
        }

        function renderAll() {
            renderProducts();
            renderCategories();
            renderCustomers();
            renderOrders();
            renderOrderItems();
            renderPayments();
            renderAccount();
            updateStats();
            updateCharts();
            syncStorage();
        }

        function updateStats() {
            document.getElementById('stat-p').innerText = products.length;
            document.getElementById('stat-c').innerText = customers.length;
            document.getElementById('stat-o').innerText = orders.length;
            document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'short', year: 'numeric' }).toUpperCase();
        }

        function searchTable(tbodyId, val) {
            const rows = document.getElementById(tbodyId).getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = rows[i].innerText.toLowerCase().includes(val.toLowerCase()) ? "" : "none";
            }
        }

        // --- LOGIKA PEMBAYARAN ---
        function renderPayments() {
            const tbody = document.getElementById('pembayaran-body');
            if(!tbody) return;
            tbody.innerHTML = '';
            payments.forEach(pay => {
                const statusClass = pay.status === 'Lunas' ? 'text-emerald-500 bg-emerald-50' : 'text-orange-500 bg-orange-50';
                tbody.innerHTML += `
                    <tr class="border-b border-slate-100 hover:bg-slate-50/50 transition-colors">
                        <td class="px-6 py-5 font-bold text-slate-400 text-xs">${pay.id}</td>
                        <td class="px-6 py-5 text-[#0D4715] font-bold">${pay.orderRef}</td>
                        <td class="px-6 py-5">${pay.method}</td>
                        <td class="px-6 py-5 font-black">${formatRupiah(pay.amount)}</td>
                        <td class="px-6 py-5">
                            <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${statusClass}">${pay.status}</span>
                        </td>
                        <td class="px-6 py-5 text-right">
                            <button onclick="deletePayment('${pay.id}')" class="text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>`;
            });
        }

        function addPayment() {
            let orderOptions = orders.map(o => `<option value="${o.id}|${o.total}">${o.id} - ${o.customer} (${formatRupiah(o.total)})</option>`).join('');
            const body = `
                <div class="space-y-5">
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Pilih Order</label>
                        <select id="payOrder" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold text-slate-700">
                            <option value="" disabled selected>Pilih Order Ref</option>
                            ${orderOptions}
                        </select>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Metode Pembayaran</label>
                        <select id="payMethod" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold text-slate-700">
                            <option value="Transfer Bank">Transfer Bank</option>
                            <option value="Tunai">Tunai</option>
                            <option value="E-Wallet">E-Wallet</option>
                            <option value="Kartu Kredit">Kartu Kredit</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Status</label>
                        <select id="payStatus" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold text-slate-700">
                            <option value="Lunas">Lunas</option>
                            <option value="Pending">Pending</option>
                        </select>
                    </div>
                </div>
            `;
            openModal("Catat Pembayaran", body, () => {
                const orderData = document.getElementById('payOrder').value;
                const method = document.getElementById('payMethod').value;
                const status = document.getElementById('payStatus').value;
                
                if(orderData) {
                    const [orderRef, amount] = orderData.split('|');
                    payments.push({
                        id: "PAY-" + Math.floor(Math.random()*9999),
                        orderRef: orderRef,
                        amount: parseInt(amount),
                        method: method,
                        status: status
                    });
                    orders = orders.filter(o => o.id !== orderRef);
                    renderAll(); closeModal();
                } else { alert("Pilih order terlebih dahulu!"); }
            });
        }

        function deletePayment(id) {
            if(confirm("Hapus data pembayaran?")) { payments = payments.filter(p => p.id !== id); renderAll(); }
        }

        // --- PRODUK LOGIC ---
        function renderProducts(data = products) {
            const grid = document.getElementById('product-grid');
            if(!grid) return;
            grid.innerHTML = '';
            data.forEach(p => {
                grid.innerHTML += `
                    <div class="product-card bg-white border border-slate-200 rounded-[30px] p-6 shadow-sm hover:shadow-2xl transition-all group">
                        <div class="flex justify-between items-start mb-4">
                             <span class="px-4 py-1.5 bg-green-50 text-[10px] font-black text-[#0D4715] uppercase rounded-full tracking-widest border border-green-100">${p.category || 'Shoes'}</span>
                        </div>
                        <div class="h-44 flex items-center justify-center mb-6 overflow-hidden rounded-[24px] bg-slate-50 p-4 border border-slate-100">
                            <img src="${p.img}" class="object-contain w-full h-full group-hover:scale-110 transition-transform duration-500">
                        </div>
                        <div class="flex flex-col mb-6">
                            <span class="font-extrabold text-slate-900 truncate mb-1">${p.name}</span>
                            <span class="text-[#0D4715] font-black text-xl">${formatRupiah(p.price)}</span>
                        </div>
                        <div class="flex justify-between items-center pt-5 border-t border-slate-100 gap-3">
                            <button onclick="deleteProduct(${p.id})" class="w-10 h-10 flex items-center justify-center rounded-xl bg-red-50 text-red-400 border border-red-100 hover:bg-red-500 hover:text-white transition-all"><i class="fas fa-trash-can text-sm"></i></button>
                            <button onclick="editProduct(${p.id})" class="flex-1 bg-[#0D4715] text-white py-2.5 rounded-xl text-xs font-black hover:bg-[#1a5c23] transition-all">Edit Detail</button>
                        </div>
                    </div>`;
            });
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function handleImagePreview(input) {
            const previewImg = document.getElementById('imagePreviewDisplay');
            const placeholder = document.getElementById('uploadPlaceholder');
            
            if (input.files && input.files[0]) {
                const base64 = await readFileAsBase64(input.files[0]);
                previewImg.src = base64;
                previewImg.classList.remove('hidden');
                placeholder.classList.add('hidden');
            }
        }

        function addProduct() {
            let catOptions = categories.map(c => `<option value="${c}">${c}</option>`).join('');
            const body = `
                <div class="space-y-5">
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Nama Sepatu</label>
                        <input id="pName" type="text" placeholder="Masukkan nama..." class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] focus:ring-4 focus:ring-green-50/50 outline-none transition-all font-bold">
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Harga (Rp)</label>
                        <input id="pPrice" type="text" placeholder="Contoh: 250.000" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] focus:ring-4 focus:ring-green-50/50 outline-none transition-all font-bold">
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Gambar Produk</label>
                        <div id="previewContent" class="p-4 border-2 border-dashed border-slate-200 rounded-2xl text-center bg-slate-50 hover:bg-green-50 transition-colors cursor-pointer relative min-h-[120px] flex items-center justify-center">
                            <div id="uploadPlaceholder">
                                <i class="fas fa-image mb-2 text-2xl text-slate-300 block"></i>
                                <span class="text-xs font-bold text-slate-400 uppercase">Klik Untuk Unggah Foto</span>
                            </div>
                            <img id="imagePreviewDisplay" class="hidden max-h-40 rounded-xl object-contain shadow-sm">
                            <input id="pFile" type="file" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="handleImagePreview(this)">
                        </div>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Kategori</label>
                        <select id="pCat" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] focus:ring-4 focus:ring-green-50/50 outline-none transition-all font-bold">
                            <option value="" disabled selected>Pilih Kategori</option>
                            ${catOptions}
                        </select>
                    </div>
                </div>
            `;
            openModal("Produk Baru", body, async () => {
                const name = document.getElementById('pName').value;
                const priceFormatted = document.getElementById('pPrice').value;
                const price = priceFormatted.replace(/\./g, ''); // Hapus titik untuk simpan angka asli
                const category = document.getElementById('pCat').value;
                const fileInput = document.getElementById('pFile');
                if(name && price && category && fileInput.files[0]) {
                    const base64Img = await readFileAsBase64(fileInput.files[0]);
                    products.push({ id: Date.now(), name, price: parseInt(price), category: category, img: base64Img });
                    renderAll(); closeModal();
                } else { alert("Mohon lengkapi semua data dan lampirkan foto!"); }
            });
            // Jalankan format titik pada input harga yang baru dibuat
            applyThousandsSeparator(document.getElementById('pPrice'));
        }

        function editProduct(id) {
            const p = products.find(prod => prod.id === id);
            let catOptions = categories.map(c => `<option value="${c}" ${p.category === c ? 'selected' : ''}>${c}</option>`).join('');
            // Nilai awal harga diformat dengan titik
            const initialPrice = new Intl.NumberFormat('id-ID').format(p.price);
            const body = `
                <div class="space-y-5">
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Nama Sepatu</label>
                        <input id="pName" type="text" value="${p.name}" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] focus:ring-4 focus:ring-green-50/50 outline-none transition-all font-bold">
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Harga (Rp)</label>
                        <input id="pPrice" type="text" value="${initialPrice}" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] focus:ring-4 focus:ring-green-50/50 outline-none transition-all font-bold">
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Gambar Produk</label>
                        <div id="previewContent" class="p-4 border-2 border-dashed border-slate-200 rounded-2xl text-center bg-slate-50 relative min-h-[120px] flex items-center justify-center">
                            <img id="imagePreviewDisplay" src="${p.img}" class="max-h-40 rounded-xl object-contain shadow-sm">
                            <input id="pFile" type="file" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="handleImagePreview(this)">
                        </div>
                        <p class="text-[9px] text-center text-slate-400 mt-2 font-bold uppercase">Klik pada gambar untuk mengganti foto</p>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Kategori</label>
                        <select id="pCat" class="w-full px-5 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] outline-none transition-all font-bold">
                            ${catOptions}
                        </select>
                    </div>
                </div>
            `;
            openModal("Edit Produk", body, async () => {
                const name = document.getElementById('pName').value;
                const priceFormatted = document.getElementById('pPrice').value;
                const price = priceFormatted.replace(/\./g, '');
                const category = document.getElementById('pCat').value;
                const fileInput = document.getElementById('pFile');
                p.name = name; p.price = parseInt(price); p.category = category;
                if(fileInput.files[0]) { p.img = await readFileAsBase64(fileInput.files[0]); }
                renderAll(); closeModal();
            });
            applyThousandsSeparator(document.getElementById('pPrice'));
        }

        function deleteProduct(id) {
            if(confirm("Hapus produk?")) { products = products.filter(p => p.id !== id); renderAll(); }
        }

        function filterProducts() {
            const query = document.getElementById('productSearch').value.toLowerCase();
            renderProducts(products.filter(p => p.name.toLowerCase().includes(query)));
        }

        // --- CUSTOMER LOGIC ---
        function renderCustomers() {
            const grid = document.getElementById('customer-grid');
            if(!grid) return;
            grid.innerHTML = '';
            customers.forEach(c => {
                grid.innerHTML += `
                <div class="bg-white p-8 rounded-[30px] shadow-sm border border-slate-200 flex items-center gap-5">
                    <div class="w-14 h-14 bg-[#0D4715] rounded-[20px] flex items-center justify-center shadow-lg font-black text-white text-lg border border-green-900">${c.name.charAt(0)}</div>
                    <div class="flex-1 overflow-hidden">
                        <p class="font-extrabold text-slate-900 truncate">${c.name}</p>
                        <p class="text-xs text-slate-400 font-bold truncate lowercase">${c.email}</p>
                    </div>
                    <button onclick="deleteCustomer(${c.id})" class="text-slate-300 hover:text-red-500 transition-all"><i class="fas fa-user-xmark"></i></button>
                </div>`;
            });
        }

        function addCustomer() {
            const body = `
                <div class="space-y-4">
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Nama Pelanggan</label>
                        <input id="cName" type="text" placeholder="Nama Lengkap" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] outline-none font-bold">
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Email</label>
                        <input id="cEmail" type="email" placeholder="Contoh: budi@mail.com" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl focus:border-[#0D4715] outline-none font-bold">
                    </div>
                </div>
            `;
            openModal("Pelanggan Baru", body, () => {
                const name = document.getElementById('cName').value;
                const email = document.getElementById('cEmail').value;
                if(name && email) { customers.push({id: Date.now(), name, email}); renderAll(); closeModal(); }
            });
        }

        function deleteCustomer(id) {
            if(confirm("Hapus customer?")) { customers = customers.filter(c => c.id !== id); renderAll(); }
        }

        // --- ORDER LOGIC ---
        function renderOrders() {
            const container = document.getElementById('order-list-container');
            if(!container) return;
            container.innerHTML = '';
            orders.forEach(o => {
                container.innerHTML += `
                <div class="bg-white border border-slate-200 p-8 rounded-[40px] flex justify-between items-center shadow-sm hover:shadow-md transition-all">
                    <div class="flex items-center gap-6">
                        <div class="w-12 h-12 bg-green-50 border border-green-100 rounded-2xl flex items-center justify-center text-[#0D4715]"><i class="fas fa-receipt"></i></div>
                        <div>
                            <p class="text-[10px] font-black text-[#0D4715] uppercase tracking-[0.2em] mb-1">${o.id}</p>
                            <h4 class="font-extrabold text-slate-900">${o.customer}</h4>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-black text-slate-900 mb-1">${formatRupiah(o.total)}</p>
                        <button onclick="deleteOrder('${o.id}')" class="text-[10px] font-black text-red-500 hover:bg-red-50 px-3 py-1 rounded-full uppercase transition-all">Batalkan</button>
                    </div>
                </div>`;
            });
        }

        function addOrder() {
            let custOptions = customers.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            let prodOptions = products.map(p => `<option value="${p.id}">${p.name} (${formatRupiah(p.price)})</option>`).join('');
            const body = `
                <div class="space-y-4">
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Pilih Pelanggan</label>
                        <select id="oCust" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold text-slate-700">${custOptions}</select>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Pilih Produk</label>
                        <select id="oProd" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold text-slate-700">${prodOptions}</select>
                    </div>
                    <div>
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Jumlah (Qty)</label>
                        <input id="oQty" type="number" value="1" min="1" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold">
                    </div>
                </div>
            `;
            openModal("Proses Order", body, () => {
                const cName = document.getElementById('oCust').value;
                const pId = document.getElementById('oProd').value;
                const qty = document.getElementById('oQty').value;
                const product = products.find(p => p.id == pId);
                if(cName && product && qty) {
                    const sub = parseInt(qty) * product.price; 
                    orders.push({ id: "ORD-" + Math.floor(Math.random()*9999), customer: cName, total: sub, items: [{p: product.name, qty: parseInt(qty), sub: sub}] });
                    renderAll(); closeModal();
                }
            });
        }

        function deleteOrder(id) {
            if(confirm("Hapus riwayat?")) { orders = orders.filter(o => o.id !== id); renderAll(); }
        }

        function renderOrderItems() {
            const tbody = document.getElementById('items-body');
            if(!tbody) return;
            tbody.innerHTML = '';
            orders.forEach(o => {
                o.items.forEach(item => {
                    tbody.innerHTML += `
                    <tr class="border-b border-slate-100 hover:bg-slate-50/50 transition-colors">
                        <td class="px-6 py-5 text-[#0D4715] font-mono text-xs font-bold">${o.id}</td>
                        <td class="px-6 py-5 text-slate-900">${item.p}</td>
                        <td class="px-6 py-5 text-slate-500">${item.qty} Pcs</td>
                        <td class="px-6 py-5 text-slate-900 font-black">${formatRupiah(item.sub)}</td>
                    </tr>`;
                });
            });
        }

        // --- KATEGORI LOGIC ---
        function renderCategories() {
            const list = document.getElementById('category-list');
            if(!list) return;
            list.innerHTML = '';
            categories.forEach((cat, index) => {
                list.innerHTML += `
                    <div class="bg-white rounded-[30px] p-8 border border-slate-200 flex justify-between items-center shadow-sm group">
                        <div class="flex items-center gap-4">
                            <div class="w-2 h-8 bg-[#0D4715] rounded-full group-hover:scale-y-125 transition-transform"></div>
                            <span class="font-extrabold text-lg text-slate-900">${cat}</span>
                        </div>
                        <button onclick="deleteCategory(${index})" class="text-slate-300 hover:text-red-500 transition-colors"><i class="fas fa-trash"></i></button>
                    </div>`;
            });
        }

        function addCategory() {
            const body = `
                <div>
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2 block ml-1">Nama Kategori</label>
                    <input id="catName" type="text" placeholder="Contoh: Casual" class="w-full px-6 py-4 bg-white border border-slate-200 rounded-2xl outline-none font-bold">
                </div>
            `;
            openModal("Buat Kategori", body, () => {
                const name = document.getElementById('catName').value;
                if(name) { categories.push(name); renderAll(); closeModal(); }
            });
        }

        function deleteCategory(index) {
            if(confirm("Hapus grup produk?")) { categories.splice(index, 1); renderAll(); }
        }

        function renderAccount() {
            document.getElementById('acc-name-display').innerText = accountData.name;
            document.getElementById('sidebar-user-name').innerText = accountData.name;
            document.getElementById('acc-avatar-preview').src = accountData.avatar;
            document.getElementById('sidebar-avatar').src = accountData.avatar;
            document.getElementById('acc-input-name').value = accountData.name;
        }

        function saveAccount() {
            const newName = document.getElementById('acc-input-name').value;
            if(newName.trim()) { accountData.name = newName; syncStorage(); renderAccount(); alert("Profil diperbarui!"); }
        }

        function updateAvatar() {
            const input = document.createElement('input');
            input.type = 'file'; input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if(file) { accountData.avatar = await readFileAsBase64(file); syncStorage(); renderAccount(); }
            };
            input.click();
        }

        function factoryReset() {
            if(confirm("Hapus semua data permanen?")) { localStorage.clear(); location.reload(); }
        }

        function exportJSON() {
            const fullData = { products, categories, customers, orders, payments, accountData };
            const blob = new Blob([JSON.stringify(fullData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'sepakat-backup.json'; a.click();
        }

        window.onload = () => { showPage('dashboard'); };
    </script>
</body>
</html>